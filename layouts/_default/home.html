{{- define "main" }}

<style>
/* ── Featured Tools Grid (inline to guarantee loading) ── */
.featured-section {
  max-width: 800px;
  margin: 0 auto 2rem;
  padding: 0 1rem;
}
.featured-heading {
  text-align: center;
  font-size: 1.35rem;
  font-weight: 700;
  margin: 0 0 1.25rem;
  color: var(--primary);
}
.featured-heading::before { content: ""; }
.featured-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 1rem;
}
.featured-card {
  position: relative;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  padding: 1.4rem 1.25rem;
  border-radius: 14px;
  color: #fff;
  text-decoration: none;
  overflow: hidden;
  min-height: 130px;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
  box-shadow: 0 4px 14px rgba(0,0,0,0.15);
}
.featured-card:hover {
  transform: scale(1.05);
  box-shadow: 0 8px 28px rgba(0,0,0,0.25);
}
.featured-card::before {
  content: "";
  position: absolute;
  inset: 0;
  background: linear-gradient(135deg, rgba(255,255,255,0.15) 0%, rgba(255,255,255,0) 60%);
  border-radius: inherit;
  pointer-events: none;
}
.featured-card-name {
  font-family: 'JetBrains Mono', 'Fira Code', monospace;
  font-size: 1.1rem;
  font-weight: 700;
  line-height: 1.3;
  text-shadow: 0 1px 3px rgba(0,0,0,0.2);
}
.featured-card-desc {
  font-size: 0.82rem;
  opacity: 0.9;
  line-height: 1.45;
  margin-top: 0.4rem;
}
.featured-card-arrow {
  align-self: flex-end;
  font-size: 1.25rem;
  margin-top: 0.5rem;
  opacity: 0;
  transform: translateX(-6px);
  transition: opacity 0.2s ease, transform 0.2s ease;
}
.featured-card:hover .featured-card-arrow {
  opacity: 1;
  transform: translateX(0);
}
.home-feed { margin-top: 1rem; }
.home-feed-heading {
  font-size: 1.15rem;
  font-weight: 600;
  color: var(--secondary);
  margin: 0 0 0.75rem;
  padding-bottom: 0.5rem;
  border-bottom: 1px solid var(--border);
}
.home-feed-heading::before { content: ""; }
@media (max-width: 768px) {
  .featured-grid { grid-template-columns: 1fr; gap: 0.85rem; }
  .featured-card { min-height: 100px; padding: 1.2rem 1rem; }
  .featured-card-arrow { opacity: 1; transform: translateX(0); }
  .featured-section { padding: 0 0.5rem; }
}
</style>

{{/* ── Profile Section ── */}}
{{- if site.Params.profileMode.enabled }}
{{- partial "index_profile.html" . }}
{{- end }}

{{/* ── Featured Tools Grid ── */}}
{{- with site.Params.featured_tools }}
<section class="featured-section">
  <h2 class="featured-heading">Featured Tools</h2>
  <div class="featured-grid">
    {{- range . }}
    <a href="{{ .url | absLangURL }}" class="featured-card" style="background: {{ .color }};">
      <span class="featured-card-name">{{ .name }}</span>
      <span class="featured-card-desc">{{ .description }}</span>
      <span class="featured-card-arrow">&rarr;</span>
    </a>
    {{- end }}
  </div>
</section>
{{- end }}

{{/* ── Latest Updates Feed ── */}}
{{- $pages := where site.RegularPages "Type" "in" site.Params.mainSections }}
{{- $pages = where $pages "Params.hiddenInHomeList" "!=" "true" }}
{{- $paginator := .Paginate $pages }}

{{- if gt (len $paginator.Pages) 0 }}
<section class="home-feed">
  <h3 class="home-feed-heading">Latest Updates</h3>

  {{- range $index, $page := $paginator.Pages }}
  <article class="post-entry">
    {{- $isHidden := ($page.Param "cover.hiddenInList") | default ($page.Param "cover.hidden") | default false }}
    {{- partial "cover.html" (dict "cxt" $page "IsSingle" false "isHidden" $isHidden) }}
    <header class="entry-header">
      <h2 class="entry-hint-parent">
        {{- $page.Title }}
        {{- if $page.Draft }}
        <span class="entry-hint" title="Draft">
          <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" fill="currentColor">
            <path d="M160-410v-60h300v60H160Zm0-165v-60h470v60H160Zm0-165v-60h470v60H160Zm360 580v-123l221-220q9-9 20-13t22-4q12 0 23 4.5t20 13.5l37 37q9 9 13 20t4 22q0 11-4.5 22.5T862.09-380L643-160H520Zm300-263-37-37 37 37ZM580-220h38l121-122-18-19-19-18-122 121v38Zm141-141-19-18 37 37-18-19Z" />
          </svg>
        </span>
        {{- end }}
      </h2>
    </header>
    {{- if (ne ($page.Param "hideSummary") true) }}
    <div class="entry-content">
      <p>{{ $page.Summary | plainify | htmlUnescape }}{{ if $page.Truncated }}...{{ end }}</p>
    </div>
    {{- end }}
    {{- if not ($page.Param "hideMeta") }}
    <footer class="entry-footer">
      {{- partial "post_meta.html" $page -}}
    </footer>
    {{- end }}
    <a class="entry-link" aria-label="post link to {{ $page.Title | plainify }}" href="{{ $page.Permalink }}"></a>
  </article>
  {{- end }}
</section>

{{- if gt $paginator.TotalPages 1 }}
<footer class="page-footer">
  <nav class="pagination">
    {{- if $paginator.HasPrev }}
    <a class="prev" href="{{ $paginator.Prev.URL | absURL }}">
      «&nbsp;{{ i18n "prev_page" }}&nbsp;
      {{- if (.Param "ShowPageNums") }}
      {{- sub $paginator.PageNumber 1 }}/{{ $paginator.TotalPages }}
      {{- end }}
    </a>
    {{- end }}
    {{- if $paginator.HasNext }}
    <a class="next" href="{{ $paginator.Next.URL | absURL }}">
      {{- i18n "next_page" }}&nbsp;
      {{- if (.Param "ShowPageNums") }}
      {{- add 1 $paginator.PageNumber }}/{{ $paginator.TotalPages }}
      {{- end }}&nbsp;»
    </a>
    {{- end }}
  </nav>
</footer>
{{- end }}

{{- end }}

{{- end }}{{- /* end main */ -}}
