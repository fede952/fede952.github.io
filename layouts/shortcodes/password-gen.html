<div class="password-generator-container">
  <div class="generator-card">
    <!-- Generated Password Display -->
    <div class="password-display-wrapper">
      <input type="text" id="generatedPassword" class="password-display" readonly value="{{ if eq .Page.Language.Lang "it" }}Clicca Genera{{ else }}Click Generate{{ end }}">
      <button id="copyBtn" class="copy-btn" title="{{ if eq .Page.Language.Lang "it" }}Copia negli appunti{{ else }}Copy to clipboard{{ end }}">
        <span id="copyIcon">ðŸ“‹</span>
      </button>
    </div>

    <!-- Password Strength Indicator -->
    <div class="strength-indicator">
      <div class="strength-label">
        {{ if eq .Page.Language.Lang "it" }}Forza Password:{{ else }}Password Strength:{{ end }}
        <span id="strengthText">-</span>
      </div>
      <div class="strength-bar-container">
        <div id="strengthBar" class="strength-bar"></div>
      </div>
    </div>

    <!-- Length Slider -->
    <div class="option-group">
      <label class="option-label">
        {{ if eq .Page.Language.Lang "it" }}Lunghezza:{{ else }}Length:{{ end }}
        <span id="lengthValue">16</span>
        {{ if eq .Page.Language.Lang "it" }}caratteri{{ else }}characters{{ end }}
      </label>
      <input type="range" id="lengthSlider" min="8" max="128" value="16" class="slider">
      <div class="slider-labels">
        <span>8</span>
        <span>128</span>
      </div>
    </div>

    <!-- Character Options -->
    <div class="option-group">
      <label class="option-label">
        {{ if eq .Page.Language.Lang "it" }}Tipi di Caratteri:{{ else }}Character Types:{{ end }}
      </label>
      <div class="checkbox-group">
        <label class="checkbox-label">
          <input type="checkbox" id="includeUppercase" checked>
          <span>{{ if eq .Page.Language.Lang "it" }}Maiuscole (A-Z){{ else }}Uppercase (A-Z){{ end }}</span>
        </label>
        <label class="checkbox-label">
          <input type="checkbox" id="includeLowercase" checked>
          <span>{{ if eq .Page.Language.Lang "it" }}Minuscole (a-z){{ else }}Lowercase (a-z){{ end }}</span>
        </label>
        <label class="checkbox-label">
          <input type="checkbox" id="includeNumbers" checked>
          <span>{{ if eq .Page.Language.Lang "it" }}Numeri (0-9){{ else }}Numbers (0-9){{ end }}</span>
        </label>
        <label class="checkbox-label">
          <input type="checkbox" id="includeSymbols" checked>
          <span>{{ if eq .Page.Language.Lang "it" }}Simboli (!@#$%...){{ else }}Symbols (!@#$%...){{ end }}</span>
        </label>
      </div>
    </div>

    <!-- Generate Button -->
    <button id="generateBtn" class="generate-btn">
      ðŸ”„ {{ if eq .Page.Language.Lang "it" }}Genera Password{{ else }}Generate Password{{ end }}
    </button>

    <!-- Security Notice -->
    <div class="security-notice">
      <strong>ðŸ”’ {{ if eq .Page.Language.Lang "it" }}Sicurezza:{{ else }}Security:{{ end }}</strong>
      {{ if eq .Page.Language.Lang "it" }}
        Questo strumento utilizza <code>crypto.getRandomValues()</code> per la generazione crittograficamente sicura.
        Tutte le operazioni vengono eseguite localmente nel browser - nessun dato viene inviato a server esterni.
      {{ else }}
        This tool uses <code>crypto.getRandomValues()</code> for cryptographically secure random generation.
        All operations run locally in your browser - no data is sent to any server.
      {{ end }}
    </div>
  </div>
</div>

<style>
.password-generator-container {
  max-width: 700px;
  margin: 2rem auto;
  padding: 0 1rem;
}

.generator-card {
  position: relative;
  background: var(--entry);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 2rem;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
}

.password-display-wrapper {
  position: relative;
  display: flex;
  gap: 0.5rem;
  margin-bottom: 1.5rem;
}

.password-display {
  flex: 1;
  background: var(--code-bg);
  border: 2px solid var(--border);
  border-radius: 8px;
  padding: 1rem;
  font-family: 'JetBrains Mono', 'Fira Code', 'Courier New', monospace;
  font-size: 1.1rem;
  color: var(--content);
  text-align: center;
  letter-spacing: 1px;
}

.copy-btn {
  background: var(--tertiary);
  border: none;
  border-radius: 8px;
  padding: 1rem 1.5rem;
  font-size: 1.5rem;
  cursor: pointer;
  transition: all 0.3s ease;
}

.copy-btn:hover {
  background: var(--primary);
  transform: scale(1.05);
}

.copy-btn:active {
  transform: scale(0.95);
}

.strength-indicator {
  margin-bottom: 2rem;
}

.strength-label {
  font-size: 0.9rem;
  margin-bottom: 0.5rem;
  color: var(--secondary);
}

#strengthText {
  font-weight: bold;
  color: var(--content);
}

.strength-bar-container {
  width: 100%;
  height: 8px;
  background: var(--tertiary);
  border-radius: 4px;
  overflow: hidden;
}

.strength-bar {
  height: 100%;
  width: 0%;
  transition: all 0.3s ease;
  border-radius: 4px;
}

.option-group {
  margin-bottom: 1.5rem;
}

.option-label {
  display: block;
  font-weight: 600;
  margin-bottom: 0.75rem;
  color: var(--content);
}

.slider {
  width: 100%;
  height: 6px;
  border-radius: 3px;
  background: var(--tertiary);
  outline: none;
  -webkit-appearance: none;
}

.slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 18px;
  height: 18px;
  border-radius: 50%;
  background: var(--primary);
  cursor: pointer;
}

.slider::-moz-range-thumb {
  width: 18px;
  height: 18px;
  border-radius: 50%;
  background: var(--primary);
  cursor: pointer;
  border: none;
}

.slider-labels {
  display: flex;
  justify-content: space-between;
  font-size: 0.8rem;
  color: var(--secondary);
  margin-top: 0.25rem;
}

.checkbox-group {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}

.checkbox-label {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  cursor: pointer;
  color: var(--content);
}

.checkbox-label input[type="checkbox"] {
  width: 18px;
  height: 18px;
  cursor: pointer;
}

.generate-btn {
  width: 100%;
  background: var(--primary);
  color: var(--theme);
  border: none;
  border-radius: 8px;
  padding: 1rem;
  font-size: 1.1rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  margin-bottom: 1.5rem;
}

.generate-btn:hover {
  opacity: 0.9;
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
}

.generate-btn:active {
  transform: translateY(0);
}

.security-notice {
  background: var(--code-bg);
  border-left: 4px solid var(--primary);
  padding: 1rem;
  border-radius: 4px;
  font-size: 0.9rem;
  color: var(--secondary);
}

.security-notice code {
  background: var(--tertiary);
  padding: 2px 6px;
  border-radius: 3px;
  font-size: 0.85rem;
}

@media (max-width: 600px) {
  .generator-card {
    padding: 1.5rem;
  }

  .password-display {
    font-size: 0.95rem;
    padding: 0.75rem;
  }

  .copy-btn {
    padding: 0.75rem 1rem;
    font-size: 1.2rem;
  }
}
</style>

<script>
(function() {
  const CHARSET = {
    uppercase: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ',
    lowercase: 'abcdefghijklmnopqrstuvwxyz',
    numbers: '0123456789',
    symbols: '!@#$%^&*()_+-=[]{}|;:,.<>?'
  };

  const lengthSlider = document.getElementById('lengthSlider');
  const lengthValue = document.getElementById('lengthValue');
  const generateBtn = document.getElementById('generateBtn');
  const copyBtn = document.getElementById('copyBtn');
  const passwordDisplay = document.getElementById('generatedPassword');
  const strengthBar = document.getElementById('strengthBar');
  const strengthText = document.getElementById('strengthText');
  const copyIcon = document.getElementById('copyIcon');

  const includeUppercase = document.getElementById('includeUppercase');
  const includeLowercase = document.getElementById('includeLowercase');
  const includeNumbers = document.getElementById('includeNumbers');
  const includeSymbols = document.getElementById('includeSymbols');

  const isItalian = {{ if eq .Page.Language.Lang "it" }}true{{ else }}false{{ end }};

  lengthSlider.addEventListener('input', (e) => {
    lengthValue.textContent = e.target.value;
  });

  function generateSecurePassword(length, options) {
    let charset = '';
    if (options.uppercase) charset += CHARSET.uppercase;
    if (options.lowercase) charset += CHARSET.lowercase;
    if (options.numbers) charset += CHARSET.numbers;
    if (options.symbols) charset += CHARSET.symbols;

    if (charset.length === 0) {
      return isItalian ? 'Seleziona almeno un tipo di carattere' : 'Please select at least one character type';
    }

    const randomValues = new Uint32Array(length);
    crypto.getRandomValues(randomValues);

    let password = '';
    for (let i = 0; i < length; i++) {
      const randomIndex = randomValues[i] % charset.length;
      password += charset[randomIndex];
    }
    return password;
  }

  function calculateStrength(password, options) {
    let strength = 0;
    const length = password.length;

    if (length >= 8) strength += 20;
    if (length >= 12) strength += 20;
    if (length >= 16) strength += 20;
    if (length >= 24) strength += 20;

    if (options.uppercase) strength += 5;
    if (options.lowercase) strength += 5;
    if (options.numbers) strength += 5;
    if (options.symbols) strength += 5;

    return Math.min(strength, 100);
  }

  function updateStrengthIndicator(strength) {
    strengthBar.style.width = strength + '%';

    if (strength < 30) {
      strengthBar.style.background = '#ef4444';
      strengthText.textContent = isItalian ? 'Debole' : 'Weak';
      strengthText.style.color = '#ef4444';
    } else if (strength < 60) {
      strengthBar.style.background = '#f59e0b';
      strengthText.textContent = isItalian ? 'Discreta' : 'Fair';
      strengthText.style.color = '#f59e0b';
    } else if (strength < 80) {
      strengthBar.style.background = '#eab308';
      strengthText.textContent = isItalian ? 'Buona' : 'Good';
      strengthText.style.color = '#eab308';
    } else {
      strengthBar.style.background = '#22c55e';
      strengthText.textContent = isItalian ? 'Forte' : 'Strong';
      strengthText.style.color = '#22c55e';
    }
  }

  generateBtn.addEventListener('click', () => {
    const length = parseInt(lengthSlider.value);
    const options = {
      uppercase: includeUppercase.checked,
      lowercase: includeLowercase.checked,
      numbers: includeNumbers.checked,
      symbols: includeSymbols.checked
    };

    const password = generateSecurePassword(length, options);
    passwordDisplay.value = password;

    const strength = calculateStrength(password, options);
    updateStrengthIndicator(strength);

    copyIcon.textContent = 'ðŸ“‹';
  });

  copyBtn.addEventListener('click', async () => {
    const password = passwordDisplay.value;
    const clickText = isItalian ? 'Clicca Genera' : 'Click Generate';
    const selectText = isItalian ? 'Seleziona almeno un tipo di carattere' : 'Please select at least one character type';

    if (password && password !== clickText && password !== selectText) {
      try {
        await navigator.clipboard.writeText(password);
        copyIcon.textContent = 'âœ…';
        setTimeout(() => { copyIcon.textContent = 'ðŸ“‹'; }, 2000);
      } catch (err) {
        console.error('Failed to copy:', err);
        copyIcon.textContent = 'âŒ';
        setTimeout(() => { copyIcon.textContent = 'ðŸ“‹'; }, 2000);
      }
    }
  });

  window.addEventListener('DOMContentLoaded', () => {
    generateBtn.click();
  });
})();
</script>
