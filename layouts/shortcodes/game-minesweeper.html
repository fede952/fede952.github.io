<div class="arcade-container" id="mines-wrapper">
    <div class="mines-container">
        <div class="mines-header">
            <span id="mines-count">ğŸ’€ 10</span>
            <span id="mines-status" style="font-size:1.4rem;">ğŸ˜</span>
            <span id="mines-timer">â± 000</span>
        </div>
        <div class="mines-grid" id="mines-grid"></div>
        <div class="game-ui" id="mines-start-screen" style="position:relative;background:transparent;height:auto;padding:20px 0;">
            <button class="neon-btn" id="mines-start-btn">START</button>
        </div>
        <div class="game-ui hidden-ui" id="mines-end-screen" style="position:relative;background:transparent;height:auto;padding:20px 0;">
            <h2 id="mines-end-title" style="font-family:monospace;margin:0 0 5px;"></h2>
            <p style="color:#fff;font-family:monospace;margin:0 0 5px;" id="mines-end-time"></p>
            <button class="neon-btn" id="mines-restart-btn">RETRY</button>
            <button class="neon-btn" id="mines-share-btn" style="border-color:#00e5ff;color:#00e5ff;">SHARE SCORE</button>
        </div>
        <p style="color:#555;font-family:monospace;font-size:0.75rem;margin-top:10px;text-align:center;" id="mines-hint">
            Left click: reveal | Right click / long press: flag ğŸš©
        </p>
    </div>
    <div id="share-modal" class="share-overlay">
        <div class="share-box">
            <div class="share-title">Mission Report</div>
            <p style="color:#888;font-family:monospace;margin-bottom:15px;">Score: <span id="final-score-display">0</span></p>
            <div class="share-grid">
                <a id="btn-x" class="share-btn" target="_blank" rel="noopener"><span class="share-icon">ğ•</span>Twitter</a>
                <a id="btn-wa" class="share-btn" target="_blank" rel="noopener"><span class="share-icon">ğŸ’¬</span>WhatsApp</a>
                <a id="btn-tg" class="share-btn" target="_blank" rel="noopener"><span class="share-icon">âœˆï¸</span>Telegram</a>
                <a id="btn-li" class="share-btn" target="_blank" rel="noopener"><span class="share-icon">ğŸ’¼</span>LinkedIn</a>
                <button id="btn-copy" class="share-btn"><span class="share-icon">ğŸ“‹</span>Copy</button>
            </div>
            <button onclick="closeShare()" class="close-share">CLOSE TERMINAL</button>
        </div>
    </div>
</div>

<script>
(function(){
    const ROWS = 10, COLS = 10, MINES = 15;
    const gridEl = document.getElementById('mines-grid');
    let cells, board, revealed, flagged, mineCount, gameOver, firstClick, timerInterval, seconds;

    function createBoard(){
        board = Array.from({length:ROWS}, ()=>new Array(COLS).fill(0));
        revealed = Array.from({length:ROWS}, ()=>new Array(COLS).fill(false));
        flagged = Array.from({length:ROWS}, ()=>new Array(COLS).fill(false));
        mineCount = MINES; gameOver = false; firstClick = true; seconds = 0;
        clearInterval(timerInterval);
        document.getElementById('mines-timer').textContent = 'â± 000';
        document.getElementById('mines-count').textContent = 'ğŸ’€ ' + mineCount;
        document.getElementById('mines-status').textContent = 'ğŸ˜';
    }

    function placeMines(safeR, safeC){
        let placed = 0;
        while(placed < MINES){
            const r = Math.floor(Math.random()*ROWS);
            const c = Math.floor(Math.random()*COLS);
            if(board[r][c] === -1) continue;
            if(Math.abs(r-safeR)<=1 && Math.abs(c-safeC)<=1) continue;
            board[r][c] = -1;
            placed++;
        }
        // Calc numbers
        for(let r=0;r<ROWS;r++) for(let c=0;c<COLS;c++){
            if(board[r][c]===-1) continue;
            let count = 0;
            for(let dr=-1;dr<=1;dr++) for(let dc=-1;dc<=1;dc++){
                const nr=r+dr, nc=c+dc;
                if(nr>=0&&nr<ROWS&&nc>=0&&nc<COLS&&board[nr][nc]===-1) count++;
            }
            board[r][c] = count;
        }
    }

    function buildGrid(){
        gridEl.innerHTML = '';
        gridEl.style.gridTemplateColumns = 'repeat('+COLS+', 1fr)';
        cells = [];
        for(let r=0;r<ROWS;r++){
            for(let c=0;c<COLS;c++){
                const cell = document.createElement('div');
                cell.className = 'mine-cell';
                cell.dataset.r = r;
                cell.dataset.c = c;
                cell.addEventListener('click', function(e){ handleClick(r,c); });
                cell.addEventListener('contextmenu', function(e){ e.preventDefault(); toggleFlag(r,c); });
                // Long press for mobile
                let pressTimer;
                cell.addEventListener('touchstart', function(e){
                    pressTimer = setTimeout(function(){ e.preventDefault(); toggleFlag(r,c); }, 400);
                }, {passive:false});
                cell.addEventListener('touchend', function(){ clearTimeout(pressTimer); });
                cell.addEventListener('touchmove', function(){ clearTimeout(pressTimer); });
                cells.push(cell);
                gridEl.appendChild(cell);
            }
        }
    }

    function handleClick(r,c){
        if(gameOver || flagged[r][c] || revealed[r][c]) return;
        if(firstClick){
            firstClick = false;
            placeMines(r,c);
            startTimer();
        }
        if(board[r][c]===-1){
            // Hit mine
            revealAll();
            gameOver = true;
            clearInterval(timerInterval);
            document.getElementById('mines-status').textContent = 'ğŸ’€';
            const endTitle = document.getElementById('mines-end-title');
            endTitle.textContent = 'VIRUS TRIGGERED';
            endTitle.style.color = '#ff003c';
            endTitle.style.textShadow = '0 0 15px #ff003c';
            document.getElementById('mines-end-time').textContent = 'TIME: '+String(seconds).padStart(3,'0')+'s';
            document.getElementById('mines-end-screen').classList.remove('hidden-ui');
            return;
        }
        reveal(r,c);
        renderCells();
        checkWin();
    }

    function reveal(r,c){
        if(r<0||r>=ROWS||c<0||c>=COLS) return;
        if(revealed[r][c]||flagged[r][c]) return;
        revealed[r][c] = true;
        if(board[r][c]===0){
            for(let dr=-1;dr<=1;dr++) for(let dc=-1;dc<=1;dc++){
                if(dr===0&&dc===0) continue;
                reveal(r+dr,c+dc);
            }
        }
    }

    function toggleFlag(r,c){
        if(gameOver||revealed[r][c]) return;
        flagged[r][c] = !flagged[r][c];
        mineCount += flagged[r][c] ? -1 : 1;
        document.getElementById('mines-count').textContent = 'ğŸ’€ ' + mineCount;
        renderCells();
    }

    function revealAll(){
        for(let r=0;r<ROWS;r++) for(let c=0;c<COLS;c++) revealed[r][c] = true;
        renderCells();
    }

    const numColors = ['','#00e5ff','#00ff41','#ff6600','#ff00ff','#ffff00','#ff003c','#7b68ee','#888'];

    function renderCells(){
        for(let r=0;r<ROWS;r++) for(let c=0;c<COLS;c++){
            const cell = cells[r*COLS+c];
            cell.className = 'mine-cell';
            cell.textContent = '';
            if(flagged[r][c] && !revealed[r][c]){
                cell.classList.add('flagged');
                cell.textContent = 'ğŸš©';
            } else if(revealed[r][c]){
                cell.classList.add('revealed');
                if(board[r][c]===-1){
                    cell.classList.add('virus');
                    cell.textContent = 'â˜£ï¸';
                } else if(board[r][c]>0){
                    cell.textContent = board[r][c];
                    cell.style.color = numColors[board[r][c]] || '#fff';
                }
            }
        }
    }

    function checkWin(){
        let unrevealed = 0;
        for(let r=0;r<ROWS;r++) for(let c=0;c<COLS;c++){
            if(!revealed[r][c]) unrevealed++;
        }
        if(unrevealed === MINES){
            gameOver = true;
            clearInterval(timerInterval);
            document.getElementById('mines-status').textContent = 'ğŸ‰';
            const endTitle = document.getElementById('mines-end-title');
            endTitle.textContent = 'GRID DEFUSED';
            endTitle.style.color = '#00ff41';
            endTitle.style.textShadow = '0 0 15px #00ff41';
            document.getElementById('mines-end-time').textContent = 'TIME: '+String(seconds).padStart(3,'0')+'s';
            document.getElementById('mines-end-screen').classList.remove('hidden-ui');
        }
    }

    function startTimer(){
        clearInterval(timerInterval);
        seconds = 0;
        timerInterval = setInterval(function(){
            seconds++;
            document.getElementById('mines-timer').textContent = 'â± '+String(seconds).padStart(3,'0');
        }, 1000);
    }

    function startGame(){
        createBoard();
        buildGrid();
        document.getElementById('mines-start-screen').classList.add('hidden-ui');
        document.getElementById('mines-end-screen').classList.add('hidden-ui');
        document.getElementById('mines-hint').style.display = '';
    }

    document.getElementById('mines-start-btn').addEventListener('click', startGame);
    document.getElementById('mines-restart-btn').addEventListener('click', startGame);
    document.getElementById('mines-share-btn').addEventListener('click', function(){
        openShare(seconds + 's', 'Node Defuser');
    });
})();
function openShare(score, gameName) {
    document.getElementById('final-score-display').innerText = score;
    document.getElementById('share-modal').classList.add('active');
    var url = window.location.href;
    var text = 'I scored ' + score + ' in ' + gameName + '! Can you beat my high score? \uD83C\uDFAE #CyberpunkGames #FedericoSella';
    document.getElementById('btn-x').href = 'https://twitter.com/intent/tweet?text=' + encodeURIComponent(text) + '&url=' + encodeURIComponent(url);
    document.getElementById('btn-wa').href = 'https://wa.me/?text=' + encodeURIComponent(text + ' ' + url);
    document.getElementById('btn-tg').href = 'https://t.me/share/url?url=' + encodeURIComponent(url) + '&text=' + encodeURIComponent(text);
    document.getElementById('btn-li').href = 'https://www.linkedin.com/sharing/share-offsite/?url=' + encodeURIComponent(url);
    document.getElementById('btn-copy').onclick = function() {
        navigator.clipboard.writeText(text + ' ' + url);
        this.innerHTML = '<span class="share-icon">\u2705</span>Copied';
        var b = this; setTimeout(function(){ b.innerHTML = '<span class="share-icon">\uD83D\uDCCB</span>Copy'; }, 2000);
    };
}
function closeShare() { document.getElementById('share-modal').classList.remove('active'); }
</script>
